(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[76],{268:(e,t,r)=>{"use strict";r.d(t,{J0:()=>n.useState,vJ:()=>n.useEffect});var n=r(8494)},2032:e=>{"use strict";let t="https://nothing.studyspark.site",r={apiCheckInterval:3e4},n=!0,a=null;function o(e){return e&&e.startsWith("ADMIN_")}function i(e){try{if(!o(e))return!1;let t=e.substring(6),r=JSON.parse(atob(t));if(Date.now()>r.expires)return!1;if(r.admin&&"admin_bypass"===r.type)return!0;return!1}catch(e){return console.error("❌ Invalid admin token format:",e),!1}}function s(e){if(!e)return!1;let t=parseInt(e);return Math.floor(Date.now()/1e3)>t}async function c(e){try{let t=await e();return n=!0,t}catch(e){throw n=!1,e}}function l(){a||(a=setInterval(async()=>{if(!n)try{let e=await fetch("".concat(t,"/api/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:"health_check"})});if(0!==e.status){n=!0,f();let e=localStorage.getItem("TOKEN");e&&!o(e)&&y()}}catch(e){}},r.apiCheckInterval))}function f(){a&&(clearInterval(a),a=null)}function u(e,t){return!!e&&(o(e)?i(e):!s(t)&&!!t)}function d(e){localStorage.getItem("TOKEN"),localStorage.getItem("expires")}function p(e,t){if(!e)return!0;if(o(e))return!i(e);if(!t)return!1;let r=parseInt(t);return Math.floor(Date.now()/1e3)>r+300}async function y(){try{let e=localStorage.getItem("TOKEN"),r=localStorage.getItem("expires");if(d("verifyUserAccess_start"),!e)return window.location.href="/verify",!1;if(o(e))if(i(e))return!0;else return g(),window.location.href="/verify",!1;if(p(e,r))return g(),window.location.href="/verify",!1;let n=async()=>{let r="verifying_".concat(e.substring(0,20));if(sessionStorage.getItem(r))return{success:!0,data:{valid:!0}};sessionStorage.setItem(r,"true");try{let n=await fetch("".concat(t,"/api/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!n.ok)throw Error("HTTP ".concat(n.status));let a=await n.json();return sessionStorage.removeItem(r),a.success&&a.data&&a.data.expires&&(localStorage.setItem("expires",a.data.expires),d("updated_expires_from_server")),a}catch(e){throw sessionStorage.removeItem(r),e}};try{let t=await c(n);if(t.success&&t.data&&t.data.valid)return d("api_verification_success"),!0;if("Token expired"===t.error||"Token not found"===t.error)g(),window.location.href="/verify";else if(u(e,r))return l(),!0;return!1}catch(t){if(u(e,r))return d("fallback_validation_success"),l(),window.showOfflineNotification&&window.showOfflineNotification("Verification server temporarily unavailable. Using offline mode."),!0;if(!p(e,r))return l(),!0;return g(),window.location.href="/verify",!1}}catch(r){console.error("\uD83D\uDCA5 Critical error in verifyUserAccess:",r),d("critical_error");let e=localStorage.getItem("TOKEN"),t=localStorage.getItem("expires");if(!p(e,t))return u(e,t);return g(),window.location.href="/verify",!1}}function g(){localStorage.removeItem("TOKEN"),localStorage.removeItem("expires"),localStorage.removeItem("userId")}async function h(){try{let e=localStorage.getItem("TOKEN"),r=localStorage.getItem("expires");if(!e)return!1;if(o(e))return i(e);if(s(r))return g(),!1;try{let r=async()=>{let r=await fetch("".concat(t,"/api/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!r.ok)throw Error("HTTP ".concat(r.status));return await r.json()},n=await c(r);if(n.success&&n.data&&n.data.valid)return!0;return g(),!1}catch(t){if(console.warn("\uD83D\uDEA8 hasValidToken API failed, using fallback:",t.message),u(e,r))return l(),!0;return g(),!1}}catch(e){return console.error("\uD83D\uDCA5 Critical error in hasValidToken:",e),u(localStorage.getItem("TOKEN"),localStorage.getItem("expires"))}}async function w(){try{let e=localStorage.getItem("TOKEN");if(!e)return null;if(o(e)){if(i(e)){let t=e.substring(6),r=JSON.parse(atob(t));return{token:e,userId:r.userId,expires:new Date(r.expires).toISOString(),valid:!0,admin:!0}}return null}let r=await fetch("".concat(t,"/api/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})});if(!r.ok)return null;let n=await r.json();if(n.success&&n.data&&n.data.valid)return n.data;return null}catch(e){return null}}function v(){f(),"undefined"!=typeof sessionStorage&&Object.keys(sessionStorage).forEach(e=>{e.startsWith("verifying_")&&sessionStorage.removeItem(e)})}function m(){if("/success"!==window.location.pathname){window.addEventListener("beforeunload",v),window.addEventListener("pagehide",v);let e=localStorage.getItem("TOKEN");!e||o(e)||n||l(),document.addEventListener("DOMContentLoaded",()=>{y()}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y()}}e.exports?e.exports={verifyUserAccess:y,hasValidToken:h,getTokenData:w,clearTokenData:g,initVerification:m}:window.VerifyScript={verifyUserAccess:y,hasValidToken:h,getTokenData:w,clearTokenData:g,initVerification:m},window.VerifyScript||(window.VerifyScript={verifyUserAccess:y,hasValidToken:h,getTokenData:w,clearTokenData:g,initVerification:m})},3536:(e,t,r)=>{"use strict";r.d(t,{vJ:()=>n.useEffect});var n=r(8494)},7882:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var n=r(3536);function a(){(0,n.vJ)(()=>{(async()=>{try{let e=await r.e(978).then(r.bind(r,8978));e.default&&"function"==typeof e.default&&e.default()}catch(e){console.error("Security script failed to load:",e)}})()},[])}},7980:(e,t,r)=>{"use strict";r.d(t,{J0:()=>n.useState,li:()=>n.useRef,tY:()=>n.Suspense,vJ:()=>n.useEffect});var n=r(8494)},9393:()=>{}}]);